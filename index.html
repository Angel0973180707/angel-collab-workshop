<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1411" />
  <title>Angel Collab Workshop</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="txt">
        <div class="title">Angel Collab Workshop</div>
        <div class="sub">骨架版｜先做工具，再長成課程</div>
      </div>
    </div>

    <div class="topActions">
      <button class="btn ghost" id="btnExport" type="button">一鍵匯出</button>
      <button class="btn ghost" id="btnImport" type="button">一鍵匯入</button>
      <button class="btn" id="btnAddTool" type="button">＋ 新增工具</button>
      <button class="btn" id="btnAddTheme" type="button">＋ 新增主題</button>
    </div>
  </header>

  <nav class="tabs" aria-label="主選單">
    <button class="tab active" data-tab="tools" type="button">工具庫</button>
    <button class="tab" data-tab="themes" type="button">主題組合</button>
    <button class="tab" data-tab="vault" type="button">成品連結倉庫</button>
    <button class="tab" data-tab="prompt" type="button">AI 協作咒語</button>
    <button class="tab" data-tab="guide" type="button">使用說明</button>
  </nav>

  <main class="wrap">
    <!-- TOOLS -->
    <section class="panel active" id="panel-tools">
      <div class="card">
        <div class="panelHeader">
          <div class="panelTitle">
            <h2>工具庫 <span class="badge" id="toolsCount">0</span></h2>
            <p class="hint">先把你會用到的工具卡放進來。每張卡可以是草稿，也可以是可用版。輸入會自動保存在本機。</p>
          </div>

          <div class="panelSearch">
            <input class="input" id="toolsSearch" placeholder="搜尋工具（名稱/一句話用途/標籤）" />
            <button class="btn ghost" id="btnSeedTool" type="button">建立示範工具（可刪）</button>
          </div>
        </div>

        <div class="sep"></div>

        <div class="list" id="toolsList"></div>
        <div class="empty" id="toolsEmpty">
          目前沒有工具卡。你可以按右上角「＋ 新增工具」，或按「建立示範工具」先看樣子。
        </div>
      </div>
    </section>

    <!-- THEMES -->
    <section class="panel" id="panel-themes">
      <div class="card">
        <div class="panelHeader">
          <div class="panelTitle">
            <h2>主題組合 <span class="badge" id="themesCount">0</span></h2>
            <p class="hint">把工具排成一條「可走的路」。你也可以直接用「複製協作咒語」把組合帶去請 AI 產生獨立 PWA。</p>
          </div>

          <div class="panelSearch">
            <input class="input" id="themesSearch" placeholder="搜尋主題（標題/描述/標籤）" />
          </div>
        </div>

        <div class="sep"></div>

        <div class="list" id="themesList"></div>
        <div class="empty" id="themesEmpty">
          目前沒有主題。你可以按右上角「＋ 新增主題」開始組合。
        </div>
      </div>
    </section>

    <!-- VAULT -->
    <section class="panel" id="panel-vault">
      <div class="card">
        <div class="panelHeader">
          <div class="panelTitle">
            <h2>成品連結倉庫 <span class="badge" id="vaultCount">0</span></h2>
            <p class="hint">未來你做出「獨立 PWA」或「公開頁」時，把網址存放在這裡，日後一鍵取用。</p>
          </div>

          <div class="panelSearch">
            <button class="btn" id="btnAddVault" type="button">＋ 新增連結</button>
            <button class="btn ghost" id="btnSeedVault" type="button">建立示範連結（可刪）</button>
          </div>
        </div>

        <div class="sep"></div>

        <div class="list" id="vaultList"></div>
        <div class="empty" id="vaultEmpty">
          目前沒有成品連結。你可以先用「建立示範連結」看樣子。
        </div>
      </div>
    </section>

    <!-- PROMPT -->
    <section class="panel" id="panel-prompt">
      <div class="card">
        <div class="panelHeader">
          <div class="panelTitle">
            <h2>AI 協作咒語</h2>
            <p class="hint">
              這裡是「內建模板」。你可以先選一個主題（在主題列表按「複製協作咒語」），或在下方手動選主題，再一鍵複製完整咒語。
            </p>
          </div>

          <div class="panelSearch">
            <select class="input select" id="promptThemePick" aria-label="選擇主題"></select>
            <button class="btn" id="btnCopyPrompt" type="button">複製協作咒語（含工具內容）</button>
            <button class="btn ghost" id="btnPreviewPrompt" type="button">預覽</button>
          </div>
        </div>

        <div class="sep"></div>

        <div class="subcard">
          <h3>模板（可改、會自動保存）</h3>
          <p class="hint">你改完模板後，按「預覽」或「複製」就會用新模板生成。</p>
          <textarea class="input textarea promptArea" id="promptTemplate" rows="16" placeholder="在這裡貼你的咒語模板…"></textarea>

          <div class="panelSearch" style="margin-top:10px;">
            <button class="btn ghost" id="btnResetPrompt" type="button">還原內建模板</button>
            <button class="btn ghost" id="btnSavePrompt" type="button">儲存模板</button>
          </div>
        </div>

        <div class="subcard">
          <h3>預覽（生成結果）</h3>
          <p class="hint">這裡會把「主題＋流程工具內容」灌進模板，讓你確認無誤。</p>
          <textarea class="input textarea promptArea" id="promptPreview" rows="16" readonly></textarea>
        </div>
      </div>
    </section>

    <!-- GUIDE -->
    <section class="panel" id="panel-guide">
      <div class="card">
        <h2>使用說明</h2>
        <p class="hint">
          這是「協作工房骨架版」：先確保資料安全，再慢慢長出工具、主題、成品。
        </p>

        <div class="sep"></div>

        <div class="subcard">
          <h3>1｜資料安全（你最需要的）</h3>
          <p class="hint">
            - 右上角「一鍵匯出」會下載一個 JSON 檔，包含：工具庫 / 主題組合 / 成品連結 / UI 設定。<br/>
            - 「一鍵匯入」可把 JSON 檔載回來（支援覆蓋或合併）。
          </p>
        </div>

        <div class="subcard">
          <h3>2｜工具卡（草稿也可以）</h3>
          <p class="hint">
            每張工具卡可放：名稱、一句話用途、陪語/內容、標籤、狀態（草稿/可用）、以及 AI 協作欄位（先預留）。
          </p>
        </div>

        <div class="subcard">
          <h3>3｜主題組合（把工具排成路）</h3>
          <p class="hint">
            主題會記住工具順序。你也可以到「AI 協作咒語」頁，直接生成一份給 AI 的「獨立 PWA 製作指令」。
          </p>
        </div>

        <div class="subcard">
          <h3>4｜PWA 安裝後不更新怎麼辦？</h3>
          <p class="hint">
            若你「已安裝到桌面」但更新不動：先把 PWA 解除安裝，再重新安裝一次（最簡單、最穩）。<br/>
            或在瀏覽器開啟後，做一次「重新整理」。
          </p>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL: TOOL -->
  <dialog class="modal" id="toolModal">
    <form method="dialog" class="modalCard" id="toolForm">
      <div class="modalHeader">
        <div>
          <div class="modalTitle" id="toolModalTitle">新增工具</div>
          <div class="modalSub">輸入會自動保存在本機。完成後按「儲存」。</div>
        </div>
        <button class="btn ghost" value="cancel" type="submit">關閉</button>
      </div>

      <div class="grid2">
        <div>
          <label class="lbl">工具名稱</label>
          <input class="input" id="tool_name" placeholder="例如：斷點停火｜暫停" />
        </div>
        <div>
          <label class="lbl">狀態</label>
          <select class="input" id="tool_status">
            <option value="draft">草稿</option>
            <option value="ready">可用</option>
          </select>
        </div>
      </div>

      <label class="lbl">一句話用途</label>
      <input class="input" id="tool_one" placeholder="例如：在自動反應全速運轉前，切回管理員模式。" />

      <label class="lbl">陪語／內容（可多行）</label>
      <textarea class="input textarea" id="tool_content" rows="7" placeholder="貼你的陪語、步驟、引導句…"></textarea>

      <div class="grid2">
        <div>
          <label class="lbl">標籤（用空白或 # 分隔）</label>
          <input class="input" id="tool_tags" placeholder="#暫停 #斷點 #情緒急救" />
        </div>
        <div>
          <label class="lbl">AI 協作提示（預留）</label>
          <input class="input" id="tool_ai" placeholder="（可先留白）例如：把內容改寫成更溫柔篤定的陪語" />
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn danger" id="toolDelete" type="button">刪除</button>
        <div class="modalRight">
          <button class="btn ghost" id="toolCopy" type="button">複製卡片內容</button>
          <button class="btn" id="toolSave" type="button">儲存</button>
        </div>
      </div>

      <input type="hidden" id="tool_id" />
    </form>
  </dialog>

  <!-- MODAL: THEME -->
  <dialog class="modal" id="themeModal">
    <form method="dialog" class="modalCard" id="themeForm">
      <div class="modalHeader">
        <div>
          <div class="modalTitle" id="themeModalTitle">新增主題</div>
          <div class="modalSub">把工具排成流程。完成後按「儲存」。</div>
        </div>
        <button class="btn ghost" value="cancel" type="submit">關閉</button>
      </div>

      <label class="lbl">主題標題</label>
      <input class="input" id="theme_title" placeholder="例如：改變｜建立新反應" />

      <label class="lbl">主題描述（副標）</label>
      <textarea class="input textarea" id="theme_desc" rows="4" placeholder="例如：當自動反應啟動時，給自己一條新的路。"></textarea>

      <div class="sep"></div>

      <div class="twoCols">
        <div class="subcard">
          <h3>可選工具</h3>
          <p class="hint">點一下加入右側（會依序排隊）。</p>
          <div class="list" id="pickToolsList"></div>
          <div class="empty small" id="pickToolsEmpty">目前沒有工具可選，先去「工具庫」新增幾張工具卡。</div>
        </div>

        <div class="subcard">
          <h3>主題流程（順序很重要）</h3>
          <p class="hint">你可以用↑↓排序。</p>
          <div class="list" id="themeFlowList"></div>
          <div class="empty small" id="themeFlowEmpty">尚未加入任何工具。</div>

          <div class="sep"></div>

          <label class="lbl">標籤（可選）</label>
          <input class="input" id="theme_tags" placeholder="#改變 #暫停 #新反應" />

          <label class="lbl">AI 協作提示（預留）</label>
          <input class="input" id="theme_ai" placeholder="（可先留白）例如：生成一份『組合練習』與獨立PWA規格" />
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn danger" id="themeDelete" type="button">刪除</button>
        <div class="modalRight">
          <button class="btn ghost" id="themeCopy" type="button">複製組合內容</button>
          <button class="btn ghost" id="themeCopyPrompt" type="button">複製協作咒語（含工具內容）</button>
          <button class="btn" id="themeSave" type="button">儲存</button>
        </div>
      </div>

      <input type="hidden" id="theme_id" />
    </form>
  </dialog>

  <!-- MODAL: VAULT -->
  <dialog class="modal" id="vaultModal">
    <form method="dialog" class="modalCard" id="vaultForm">
      <div class="modalHeader">
        <div>
          <div class="modalTitle" id="vaultModalTitle">新增成品連結</div>
          <div class="modalSub">把可分享的網址收納起來（例如獨立PWA、公開頁、課程頁）。</div>
        </div>
        <button class="btn ghost" value="cancel" type="submit">關閉</button>
      </div>

      <label class="lbl">名稱</label>
      <input class="input" id="vault_title" placeholder="例如：改變｜建立新反應（獨立PWA）" />

      <label class="lbl">網址</label>
      <input class="input" id="vault_url" placeholder="https://yourname.github.io/xxx/" />

      <label class="lbl">備註</label>
      <textarea class="input textarea" id="vault_note" rows="4" placeholder="例如：v1.0｜可給學員使用｜搭配哪支影片"></textarea>

      <div class="modalFooter">
        <button class="btn danger" id="vaultDelete" type="button">刪除</button>
        <div class="modalRight">
          <button class="btn" id="vaultSave" type="button">儲存</button>
        </div>
      </div>

      <input type="hidden" id="vault_id" />
    </form>
  </dialog>

  <!-- hidden file input for import -->
  <input type="file" id="importFile" accept="application/json" hidden />

  <footer class="footer">
    <div class="small">Angel Collab Workshop｜本機保存（localStorage）＋ 一鍵匯出/匯入（JSON）</div>
  </footer>

  <script src="app.js"></script>
</body>
</html>